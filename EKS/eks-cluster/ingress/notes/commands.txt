
https://docs.aws.amazon.com/eks/latest/userguide/lbc-helm.html

curl -O https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.14.1/docs/install/iam_policy.json

aws iam create-policy \
    --policy-name AWSLoadBalancerControllerIAMPolicy \
    --policy-document file://iam_policy.json

☁  notes  eksctl create iamserviceaccount \
    --cluster=k8s-abhishek \
    --namespace=kube-system \
    --name=aws-load-balancer-controller \
    --attach-policy-arn=arn:aws:iam::xxxxxxxxxxx:policy/AWSLoadBalancerControllerIAMPolicy \
    --override-existing-serviceaccounts \
    --region us-east-1 \
    --approve
2025-12-28 22:19:54 [ℹ]  1 iamserviceaccount (kube-system/aws-load-balancer-controller) was included (based on the include/exclude rules)
2025-12-28 22:19:54 [!]  metadata of serviceaccounts that exist in Kubernetes will be updated, as --override-existing-serviceaccounts was set
2025-12-28 22:19:54 [ℹ]  1 task: {
    2 sequential sub-tasks: {
        create IAM role for serviceaccount "kube-system/aws-load-balancer-controller",
        create serviceaccount "kube-system/aws-load-balancer-controller",
    } }2025-12-28 22:19:54 [ℹ]  building iamserviceaccount stack "eksctl-k8s-abhishek-addon-iamserviceaccount-kube-system-aws-load-balancer-controller"
2025-12-28 22:19:54 [ℹ]  deploying stack "eksctl-k8s-abhishek-addon-iamserviceaccount-kube-system-aws-load-balancer-controller"
2025-12-28 22:19:54 [ℹ]  waiting for CloudFormation stack "eksctl-k8s-abhishek-addon-iamserviceaccount-kube-system-aws-load-balancer-controller"
2025-12-28 22:20:24 [ℹ]  waiting for CloudFormation stack "eksctl-k8s-abhishek-addon-iamserviceaccount-kube-system-aws-load-balancer-controller"
2025-12-28 22:20:25 [ℹ]  created serviceaccount "kube-system/aws-load-balancer-controller"
☁  notes


aws eks describe-cluster --name k8s-abhishek --query "cluster.identity.oidc.issuer"
"https://oidc.eks.us-east-1.amazonaws.com/id/55E112DA8A15CD029863AEE6C7C66DDC"

aud -> Audiance

Audience
The intended audience (also known as client ID) of the web identity token. This is traditionally the client identifier issued to the application that requested the web identity token.


SubjectFromWebIdentityToken
The unique user identifier that is returned by the identity provider. This identifier is associated with the WebIdentityToken that was submitted with the AssumeRoleWithWebIdentity call. The identifier is typically unique to the user and the application that acquired the WebIdentityToken (pairwise identifier). For OpenID Connect ID tokens, this field contains the value returned by the identity provider as the token's sub (Subject) claim.




trust_relationships

{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Federated": "arn:aws:iam::xxxxxxxxxxx:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/55E112DA8A15CD029863AEE6C7C66DDC"
            },
            "Action": "sts:AssumeRoleWithWebIdentity",
            "Condition": {
                "StringEquals": {
                    "oidc.eks.us-east-1.amazonaws.com/id/55E112DA8A15CD029863AEE6C7C66DDC:aud": "sts.amazonaws.com",
                    "oidc.eks.us-east-1.amazonaws.com/id/55E112DA8A15CD029863AEE6C7C66DDC:sub": "system:serviceaccount:kube-system:aws-load-balancer-controller"
                }
            }
        }
    ]
}


helm repo add eks https://aws.github.io/eks-charts

helm repo update eks


helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
  -n kube-system \
  --set clusterName=my-cluster \
  --set serviceAccount.create=false \
  --set serviceAccount.name=aws-load-balancer-controller \
  --version 1.14.0




  ☁  notes  curl -O  https://raw.githubusercontent.com/aws/eks-charts/master/stable/aws-load-balancer-controller/crds/crds.yaml
  kubectl apply -f crds.yaml
    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                   Dload  Upload   Total   Spent    Left  Speed
  100 66298  100 66298    0     0   161k      0 --:--:-- --:--:-- --:--:--  161k
  customresourcedefinition.apiextensions.k8s.io/albtargetcontrolconfigs.elbv2.k8s.aws created
  customresourcedefinition.apiextensions.k8s.io/globalaccelerators.aga.k8s.aws created
  customresourcedefinition.apiextensions.k8s.io/ingressclassparams.elbv2.k8s.aws created
  customresourcedefinition.apiextensions.k8s.io/targetgroupbindings.elbv2.k8s.aws created
  ☁  notes


https://github.com/devopsabi
https://github.com/abhinoc/
